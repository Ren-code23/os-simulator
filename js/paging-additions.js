
// Sample Data Functions for Paging
function loadPagingSample(sampleNum) {
    if (sampleNum === 1) {
        // Classic Example
        document.getElementById('referenceString').value = '7,0,1,2,0,3,0,4,2,3,0,3,2';
        document.getElementById('numFrames').value = 3;
    } else if (sampleNum === 2) {
        // Extended Sequence
        document.getElementById('referenceString').value = '1,2,3,4,1,2,5,1,2,3,4,5,6,7,1';
        document.getElementById('numFrames').value = 4;
    } else if (sampleNum === 3) {
        // Complex Case
        document.getElementById('referenceString').value = '2,3,2,1,5,2,4,5,3,2,5,2,1,3,4';
        document.getElementById('numFrames').value = 3;
    }
    
    // Trigger calculation
    calculatePageReplacement();
}

// Export Functions for Paging
function exportPagingResults() {
    const resultsDiv = document.getElementById('pagingResults');
    if (!resultsDiv || resultsDiv.innerHTML.trim() === '') {
        alert('No results to export. Please enter data first.');
        return;
    }
    
    const referenceString = document.getElementById('referenceString').value;
    const numFrames = document.getElementById('numFrames').value;
    
    let exportText = '========================================\n';
    exportText += 'PAGE REPLACEMENT RESULTS\n';
    exportText += 'Comparison of FIFO, LRU, and Optimal\n';
    exportText += '========================================\n\n';
    
    exportText += 'Configuration:\n';
    exportText += `Reference String: ${referenceString}\n`;
    exportText += `Number of Frames: ${numFrames}\n\n`;
    
    exportText += resultsDiv.innerText;
    exportText += '\n\n========================================\n';
    exportText += 'Generated by OS Simulator\n';
    exportText += `Date: ${new Date().toLocaleString()}\n`;
    exportText += '========================================\n';
    
    downloadAsFile('paging-results.txt', exportText);
    
    const exportSection = document.getElementById('pagingExport');
    if (exportSection) {
        exportSection.style.display = 'flex';
    }
}

function copyPagingResults() {
    const resultsDiv = document.getElementById('pagingResults');
    if (!resultsDiv || resultsDiv.innerHTML.trim() === '') {
        alert('No results to copy. Please enter data first.');
        return;
    }
    
    copyToClipboard(resultsDiv.innerText);
}

// Enhanced Display with Comparison
function displayPagingResultsWithComparison(results) {
    const resultsDiv = document.getElementById('pagingResults');
    resultsDiv.innerHTML = '';
    
    // Create comparison section
    const comparisonDiv = document.getElementById('pagingComparison');
    if (comparisonDiv) {
        const pageFaults = results.map(r => ({
            algorithm: r.algorithm,
            faults: r.pageFaults
        }));
        
        const minFaults = Math.min(...pageFaults.map(r => r.faults));
        const maxFaults = Math.max(...pageFaults.map(r => r.faults));
        
        let comparisonHTML = '<h3>Algorithm Comparison</h3>';
        comparisonHTML += '<div class="comparison-bars">';
        
        pageFaults.forEach(result => {
            const isBest = result.faults === minFaults;
            const isWorst = result.faults === maxFaults;
            const barClass = isBest ? 'best' : (isWorst && minFaults !== maxFaults ? 'worst' : '');
            const percentage = (result.faults / maxFaults) * 100;
            
            comparisonHTML += `
                <div class="comparison-item">
                    <div class="comparison-label">${result.algorithm}:</div>
                    <div class="comparison-bar ${barClass}" style="width: ${percentage}%;">
                        <div class="comparison-value">${result.faults} faults ${isBest ? '‚≠ê BEST' : ''}</div>
                    </div>
                </div>
            `;
        });
        
        comparisonHTML += '</div>';
        comparisonDiv.innerHTML = comparisonHTML;
    }
    
    // Display detailed results
    displayPagingResults(results);
    
    // Show export section
    const exportSection = document.getElementById('pagingExport');
    if (exportSection) {
        exportSection.style.display = 'flex';
    }
}

// Update the calculation function to use comparison
const originalCalculatePageReplacement = calculatePageReplacement;
calculatePageReplacement = function() {
    // Get inputs
    const referenceStringInput = document.getElementById('referenceString').value.trim();
    const numFrames = parseInt(document.getElementById('numFrames').value);
    
    // Validation
    if (!referenceStringInput) {
        showPagingError('Please enter a reference string');
        return;
    }
    
    // Parse reference string
    const referenceString = referenceStringInput.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
    
    if (referenceString.length === 0) {
        showPagingError('Invalid reference string. Please use comma-separated numbers.');
        return;
    }

    // Validation for number of frames
    if (isNaN(numFrames) || numFrames < 1) {
        showPagingError('Number of frames must be at least 1.');
        return;
    }
    
    if (numFrames > referenceString.length) {
        showPagingError('Number of frames cannot exceed the length of the reference string.');
        return;
    }

    // Calculate all algorithms
    const fifoResult = fifoPageReplacement(referenceString, numFrames);
    const lruResult = lruPageReplacement(referenceString, numFrames);
    const optimalResult = optimalPageReplacement(referenceString, numFrames);
    
    // Display results with comparison
    displayPagingResultsWithComparison([fifoResult, lruResult, optimalResult]);
};

// Make functions global
window.loadPagingSample = loadPagingSample;
window.exportPagingResults = exportPagingResults;
window.copyPagingResults = copyPagingResults;

